# TOP_N 48小时监控时间表

**监控开始**: 2025-12-22 20:10 CST
**监控结束**: 2025-12-24 20:10 CST
**服务器**: 39.105.12.124

---

## 监控检查点

| 检查点 | 日期时间 | 状态 | 检查人 | 耗时 | 备注 |
|--------|---------|------|--------|------|------|
| **0h** (首次) | 2025-12-22 20:10 | ✅ 完成 | Claude Code | 11分钟 | 部署后立即检查 |
| **6h** | 2025-12-23 02:10 | ⏳ 待执行 | 手动 | - | 凌晨检查 |
| **12h** | 2025-12-23 08:10 | ⏳ 待执行 | 手动 | - | 早晨检查 |
| **18h** | 2025-12-23 14:10 | ⏳ 待执行 | 手动 | - | 下午检查 |
| **24h** | 2025-12-23 20:10 | ⏳ 待执行 | 手动 | - | 中期评估 |
| **30h** | 2025-12-24 02:10 | ⏳ 待执行 | 手动 | - | 凌晨检查 |
| **36h** | 2025-12-24 08:10 | ⏳ 待执行 | 手动 | - | 早晨检查 |
| **42h** | 2025-12-24 14:10 | ⏳ 待执行 | 手动 | - | 下午检查 |
| **48h** (最终) | 2025-12-24 20:10 | ⏳ 待执行 | 手动 | - | 最终评估 |

---

## 每次检查的标准流程

### 1. 连接到服务器 (1分钟)

```bash
ssh u_topn@39.105.12.124
```

### 2. 服务状态检查 (2分钟)

```bash
# 检查服务是否运行
sudo systemctl status topn

# 检查进程
ps aux | grep gunicorn | grep -v grep

# 检查服务启动时间
systemctl show topn --property=ActiveEnterTimestamp
```

### 3. 系统资源检查 (2分钟)

```bash
# CPU和负载
top -bn1 | head -10

# 内存使用
free -m

# 磁盘使用
df -h /home/u_topn

# Gunicorn内存
ps aux | grep gunicorn | grep -v grep
```

### 4. 日志检查 (3分钟)

```bash
# 检查最近6小时的错误
sudo journalctl -u topn.service --since "6 hours ago" | grep -i error

# 检查最近的日志
sudo journalctl -u topn.service -n 50 --no-pager

# 统计错误数
sudo journalctl -u topn.service --since "6 hours ago" | grep -c "ERROR"
```

### 5. 健康检查 (1分钟)

```bash
# API健康检查
curl http://localhost:8080/api/health

# 新路由测试
curl -s -o /dev/null -w "HTTP %{http_code}\n" http://localhost:8080/api/platforms
curl -s -o /dev/null -w "HTTP %{http_code}\n" -X POST http://localhost:8080/api/csdn/login
```

### 6. 记录结果 (2分钟)

编辑 `monitoring_log_20251222.md` 添加本次检查的结果

---

## 检查点详细说明

### 检查点 0 (首次检查) ✅ 已完成

**时间**: 2025-12-22 20:10
**重点**: 确认部署成功，建立基线数据

**结果摘要**:
- ✅ 服务状态: Active (running)
- ✅ 进程: 6个正常运行
- ✅ CPU负载: 0.23 (优秀)
- ✅ 内存: 1166MB/1871MB (62%, 正常)
- ✅ 错误: 0
- ✅ 健康检查: 通过
- ✅ 新路由: 全部可访问

**决策**: 继续监控

---

### 检查点 6 (第6小时)

**时间**: 2025-12-23 02:10 (周一凌晨)
**重点**: 验证夜间稳定性

**检查重点**:
- 服务是否持续运行
- 是否有夜间错误
- 资源使用是否稳定
- 与基线数据对比

**预期结果**:
- 服务持续运行 6+ 小时
- 零错误记录
- 资源使用与基线相近

---

### 检查点 12 (第12小时)

**时间**: 2025-12-23 08:10 (周一早晨)
**重点**: 工作时间前检查

**检查重点**:
- 准备迎接用户流量
- 12小时稳定性
- 趋势分析

---

### 检查点 18 (第18小时)

**时间**: 2025-12-23 14:10 (周一下午)
**重点**: 工作时段性能

**检查重点**:
- 用户流量下的表现
- 响应时间
- 新路由实际使用情况

---

### 检查点 24 (中期评估) ⚠️ 重要

**时间**: 2025-12-23 20:10 (周一晚上)
**重点**: 24小时完整评估

**检查重点**:
- 24小时运行稳定性
- 累计指标分析
- 是否需要调整监控策略
- 决策: 继续 / 提前结束 / 问题处理

**决策标准**:
- ✅ 如果 24h 零错误 → 可考虑降低监控频率或提前结束
- ⚠️ 如果有轻微问题 → 继续密切监控
- ❌ 如果有严重问题 → 考虑回滚

---

### 检查点 30-42 (后半程)

**时间**: 2025-12-24 02:10, 08:10, 14:10
**重点**: 持续验证稳定性

**检查重点**:
- 长期稳定性
- 性能退化检测
- 资源泄漏检测

---

### 检查点 48 (最终评估) ⚠️ 重要

**时间**: 2025-12-24 20:10 (周二晚上)
**重点**: 最终决策

**检查重点**:
- 48小时完整数据汇总
- 趋势分析
- 用户反馈整理
- **决策: 进入P6归档阶段 or 回滚**

**决策标准**:
- ✅ **进入P6**: 错误率<0.1%, 无严重问题, 用户满意
- ⚠️ **延长监控**: 有轻微问题需观察
- ❌ **回滚**: 严重问题或高错误率

---

## 成功标准

### 技术指标

| 指标 | 目标值 | 实际值 (48h后填写) |
|------|--------|-------------------|
| 服务可用性 | >99.9% | - |
| 错误率 | <0.1% | - |
| CPU负载 (1分钟) | <1.0 | - |
| 内存使用 | <80% | - |
| 磁盘使用 | <90% | - |
| 平均响应时间 | <200ms | - |

### 功能指标

| 指标 | 目标 | 实际 (48h后填写) |
|------|------|-----------------|
| 新路由可访问性 | 7/7 | - |
| 新路由调用次数 | >0 | - |
| 用户投诉 | 0 | - |

---

## 问题响应级别

### 级别 1: 信息 (INFO)

**特征**:
- 轻微日志信息
- 性能在正常范围

**行动**:
- 记录观察
- 继续监控

### 级别 2: 警告 (WARNING)

**特征**:
- 少量非致命错误
- 性能接近阈值

**行动**:
1. 详细检查日志
2. 增加监控频率至每2小时
3. 准备热修复方案

### 级别 3: 错误 (ERROR)

**特征**:
- 功能受影响
- 性能明显下降
- 用户报告问题

**行动**:
1. 立即调查根本原因
2. 评估是否需要回滚
3. 通知相关人员
4. 准备修复或回滚

### 级别 4: 严重 (CRITICAL)

**特征**:
- 服务不可用
- 数据损坏
- 多用户无法使用

**行动**:
1. **立即执行回滚**
2. 通知所有相关人员
3. 事后分析

**回滚命令**:
```bash
cd /d/code/TOP_N
bash rollback_deployment.sh
```

---

## 监控工具

### 快速检查脚本

位置: `/home/u_topn/quick_check.sh`

```bash
#!/bin/bash
# 快速健康检查脚本

echo "=== TOP_N 快速检查 - $(date) ==="
echo ""

# 服务状态
echo "1. 服务状态:"
systemctl is-active topn && echo "✓ 运行中" || echo "✗ 已停止"
echo ""

# 错误数
echo "2. 最近1小时错误:"
journalctl -u topn.service --since "1 hour ago" | grep -c "ERROR" || echo "0"
echo ""

# 健康检查
echo "3. API健康:"
curl -s http://localhost:8080/api/health | grep -q "healthy" && echo "✓ 健康" || echo "✗ 异常"
echo ""

# 资源
echo "4. 资源使用:"
echo "CPU负载: $(uptime | awk -F'load average:' '{print $2}')"
echo "内存: $(free -m | awk 'NR==2{printf \"%.1f%%\", $3*100/$2}')"
echo "磁盘: $(df -h / | awk 'NR==2{print $5}')"
```

### 详细检查脚本

位置: `verify_production.sh`

---

## 通知清单

### 每日报告 (可选)

- [ ] 第24小时发送中期报告
- [ ] 第48小时发送最终报告

### 问题通知 (必需)

- [ ] 发现ERROR级别问题时立即通知
- [ ] 发现CRITICAL问题时电话通知

---

## 监控数据收集

### 自动收集

- 系统指标 (CPU, 内存, 磁盘)
- 服务日志
- 错误统计

### 手动收集

- 用户反馈
- 性能体验
- 功能使用情况

---

## 备注

### 特殊考虑

- **周末流量**: 可能较低，不代表实际使用
- **工作时段**: 周一-周五 09:00-18:00 为高峰
- **夜间**: 流量最低，但稳定性最重要

### 调整权限

监控人员可根据实际情况调整:
- 监控频率 (如24h后改为每12小时)
- 检查深度 (如稳定后简化检查)
- 提前结束监控 (如36h已证明稳定)

---

**文档版本**: 1.0
**创建时间**: 2025-12-22 20:22
**最后更新**: 2025-12-22 20:22
**负责人**: Claude Code
