# 文章一键发布功能 - 使用指南

**部署时间**: 2025-12-06 20:42
**版本**: v1.0
**状态**: ✅ 已部署运行

---

## 功能概述

现在TopN平台支持**一键发布文章到知乎**功能！

生成的每篇文章都有一个"🚀 发布到知乎"按钮，点击后：
1. 自动选择已登录的知乎账号
2. 确认后自动登录并发布到知乎
3. 实时显示发布状态
4. 发布成功后可直接查看文章

**无需手动登录，无需复制粘贴，一键完成发布！**

---

## 完整使用流程

### 步骤1: 配置知乎账号

#### 1.1 打开账号配置页面

访问: http://39.105.12.124:8080

点击右上角的"⚙️ 账号配置"按钮

#### 1.2 添加知乎账号

在账号配置页面:
1. 平台选择 → "知乎"
2. 用户名 → 填写知乎账号标识（如：account_1）
3. 密码 → 填写任意密码（仅用于配置）
4. 备注 → 可选，如"主账号"

点击"添加账号"

#### 1.3 扫码登录知乎

点击新添加账号右侧的"测试"按钮：

1. **弹出二维码窗口** - 显示知乎登录二维码
2. **打开知乎App** - 扫描二维码
3. **确认登录** - 在手机上点击确认
4. **等待状态变化**:
   - `waiting` → 等待扫码
   - `scanned` → 已扫描，等待确认
   - `success` → 登录成功！

5. **Cookie自动保存** - 登录成功后Cookie会自动保存到服务器

**重要**: 只有状态显示为`success`的账号才能用于自动发布

---

### 步骤2: 生成推广文章

#### 2.1 输入公司/产品信息

在首页:
1. 填写公司/产品名称
2. 填写详细描述（或上传文档）
3. 选择生成文章数量（3-5篇）

点击"开始分析"

#### 2.2 查看分析结果

系统会分析您的信息并生成推广策略

点击"生成推广文章"

#### 2.3 查看生成的文章

系统会生成多篇推广文章，每篇文章包括:
- 文章类型标签
- 标题
- 正文内容
- **发布按钮** ⬅️ 新功能！

---

### 步骤3: 一键发布到知乎

#### 3.1 点击发布按钮

在任意一篇文章下方，点击"🚀 发布到知乎"按钮

#### 3.2 选择知乎账号（如有多个）

**如果只有一个知乎账号**:
- 自动选择，无需手动选择

**如果有多个知乎账号**:
- 弹出提示框，显示所有可用账号
- 输入序号（1, 2, 3...）选择账号

#### 3.3 确认发布

系统会显示确认对话框:
```
确认发布到知乎？

标题: XXX
账号: account_1

文章将公开发布
```

点击"确定"开始发布

#### 3.4 查看发布状态

按钮右侧会实时显示状态:

| 状态 | 说明 |
|------|------|
| ⏳ 检查账号... | 正在检查可用账号 |
| ⏳ 正在发布... | 正在自动登录并发布文章 |
| ✅ 发布成功！[查看文章] | 发布成功，点击链接查看 |
| ❌ 发布失败: XXX | 发布失败，显示错误原因 |
| ⚠️ 已取消 | 用户取消了发布 |

#### 3.5 查看已发布文章

发布成功后，点击"查看文章"链接，会在新标签页打开知乎文章页面

---

## 功能特性

### 1. 自动登录
- 使用已保存的Cookie自动登录
- 无需手动输入账号密码
- 无需处理验证码

### 2. 智能账号选择
- 自动过滤只显示已登录的知乎账号
- 单个账号时自动选择
- 多个账号时弹框选择

### 3. 安全确认
- 发布前必须确认
- 显示文章标题和账号信息
- 可以取消发布操作

### 4. 实时状态反馈
- 发布过程中实时显示状态
- 成功后提供文章链接
- 失败时显示详细错误

### 5. 公开发布
- 文章直接发布到知乎（非草稿）
- 所有人可见
- 符合知乎社区规范

---

## 常见问题

### Q1: 点击发布后提示"请先在账号配置中添加并登录知乎账号"

**原因**: 没有已登录的知乎账号

**解决方法**:
1. 点击"⚙️ 账号配置"
2. 添加知乎账号
3. 点击"测试"进行扫码登录
4. 等待状态变为`success`

---

### Q2: 发布失败，提示"未登录"或"Cookie失败"

**原因**: Cookie可能过期

**解决方法**:
1. 重新在账号配置中测试该账号
2. 重新扫码登录
3. 登录成功后重试发布

---

### Q3: 有多个知乎账号，如何选择用哪个发布？

**解决方法**:
1. 点击"发布到知乎"按钮
2. 在弹出的对话框中输入序号（1, 2, 3...）
3. 按回车确认选择

---

### Q4: 可以修改文章后再发布吗？

**当前版本**: 暂不支持在线编辑

**替代方案**:
1. 生成文章后复制内容
2. 手动登录知乎
3. 创建新文章并粘贴内容
4. 编辑后手动发布

**未来计划**: 将添加文章编辑功能

---

### Q5: 发布的文章可以删除吗？

**方法**:
1. 点击发布成功后的"查看文章"链接
2. 在知乎页面上可以删除或编辑文章

**注意**: 删除操作在知乎平台上进行，不在TopN平台

---

### Q6: 可以保存为草稿吗？

**当前版本**: 直接发布，不支持草稿

**临时方案**:
- 如需草稿功能，请联系管理员修改配置

**未来计划**: 将添加草稿/发布选项

---

### Q7: 发布失败怎么办？

**常见原因和解决方法**:

| 错误提示 | 原因 | 解决方法 |
|---------|------|---------|
| 未登录 | Cookie过期 | 重新扫码登录 |
| 找不到编辑器 | 知乎界面更新 | 联系管理员更新选择器 |
| 网络错误 | 服务器连接问题 | 检查网络，稍后重试 |
| 内容违规 | 不符合知乎规范 | 修改文章内容 |

---

## 技术原理

### 工作流程

```
1. 用户点击"发布到知乎"
   ↓
2. 前端查询已登录的知乎账号
   ↓
3. 用户选择账号（或自动选择）
   ↓
4. 用户确认发布
   ↓
5. 调用后端API: POST /api/zhihu/post
   ↓
6. 后端加载Cookie，自动登录知乎
   ↓
7. 访问知乎创作页面
   ↓
8. 自动填写标题和内容
   ↓
9. 点击发布按钮
   ↓
10. 返回文章URL给前端
    ↓
11. 前端显示发布成功，提供链接
```

### 核心API

**接口**: `POST /api/zhihu/post`

**请求参数**:
```json
{
  "username": "account_1",     // 知乎账号标识
  "title": "文章标题",         // 文章标题
  "content": "文章正文...",    // 文章内容
  "topics": [],               // 话题标签（可选）
  "draft": false              // false=直接发布, true=保存草稿
}
```

**响应示例**:
```json
{
  "success": true,
  "message": "文章发布成功",
  "type": "published",
  "url": "https://zhuanlan.zhihu.com/p/123456789"
}
```

---

## 系统要求

### 前置条件
- ✅ 知乎账号（已注册）
- ✅ 知乎App（用于扫码登录）
- ✅ 网络连接

### 浏览器支持
- ✅ Chrome / Edge（推荐）
- ✅ Firefox
- ✅ Safari
- ⚠️ IE 不支持

---

## 安全须知

### Cookie安全
- Cookie保存在服务器端，加密存储
- 仅用于自动登录知乎
- 定期检查Cookie有效性

### 账号安全
- 建议使用专门的营销账号
- 不建议使用个人主账号
- 定期更换密码

### 内容合规
- 确保内容符合知乎社区规范
- 避免发布广告、垃圾信息
- 尊重知识产权

---

## 备份与恢复

### 备份文件位置

服务器端备份:
```
/home/u_topn/TOP_N/static/app_upload.js.backup_publish
/home/u_topn/TOP_N/static/style.css.backup_publish
```

本地备份:
```
D:\work\code\TOP_N\add_publish_button.py
```

### 恢复操作

如需恢复到发布功能之前的版本:

```bash
ssh u_topn@39.105.12.124
cd /home/u_topn/TOP_N/static
cp app_upload.js.backup_publish app_upload.js
cp style.css.backup_publish style.css
sudo systemctl restart topn
```

---

## 更新日志

### v1.0 (2025-12-06)
- ✅ 添加"发布到知乎"按钮
- ✅ 实现自动登录和发布
- ✅ 添加账号选择功能
- ✅ 添加发布状态显示
- ✅ 添加发布成功链接

---

## 相关文档

- `DEPLOYMENT_COMPLETE_SUMMARY.md` - 完整部署总结
- `ZHIHU_AUTO_POST_README.md` - 知乎自动发帖API文档
- `COOKIE_SAVE_FIX_SUMMARY.md` - Cookie保存问题修复记录

---

## 联系支持

如遇到问题或有建议，请通过以下方式联系:

**快速查看日志**:
```bash
ssh u_topn@39.105.12.124
sudo journalctl -u topn -f | grep -i zhihu
```

**重启服务**:
```bash
ssh u_topn@39.105.12.124
sudo systemctl restart topn
```

---

## 总结

🎉 **恭喜！文章一键发布功能已成功部署！**

现在您可以:
1. ✅ 扫码登录知乎账号
2. ✅ 生成推广文章
3. ✅ 点击按钮自动发布
4. ✅ 查看已发布文章

**开始使用**: http://39.105.12.124:8080

享受便捷的内容发布体验！🚀
