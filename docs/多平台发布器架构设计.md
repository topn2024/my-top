# å¤šå¹³å°å‘å¸ƒå™¨æ¶æ„è®¾è®¡æ–‡æ¡£

## ä¸€ã€æ¶æ„æ¦‚è¿°

### 1.1 è®¾è®¡ç›®æ ‡

- **å¯æ‰©å±•æ€§**: è½»æ¾æ·»åŠ æ–°å¹³å°æ”¯æŒ
- **ç»Ÿä¸€æ¥å£**: æ‰€æœ‰å¹³å°ä½¿ç”¨ç›¸åŒçš„APIè°ƒç”¨æ–¹å¼
- **ç‹¬ç«‹æ¨¡å—**: æ¯ä¸ªå¹³å°çš„å®ç°å®Œå…¨ç‹¬ç«‹,äº’ä¸å½±å“
- **Cookieç®¡ç†**: ç»Ÿä¸€çš„Cookieå­˜å‚¨å’Œåˆ·æ–°æœºåˆ¶
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„å¼‚å¸¸æ•è·å’Œé”™è¯¯æŠ¥å‘Š
- **æ—¥å¿—è®°å½•**: è¯¦ç»†çš„æ“ä½œæ—¥å¿—ä¾¿äºè°ƒè¯•

### 1.2 æ”¯æŒå¹³å°

**å·²å®ç°**:
- âœ… çŸ¥ä¹ (Zhihu)

**è®¡åˆ’å®ç°**:
- ğŸ”² CSDN
- ğŸ”² æ˜é‡‘ (Juejin)
- ğŸ”² ç®€ä¹¦ (Jianshu)
- ğŸ”² åšå®¢å›­ (CNBlogs)
- ğŸ”² å¾®ä¿¡å…¬ä¼—å· (WeChat MP)

---

## äºŒã€æ¶æ„è®¾è®¡

### 2.1 ç±»å±‚æ¬¡ç»“æ„

```
BasePlatformPublisher (æŠ½è±¡åŸºç±»)
â”œâ”€â”€ ZhihuPublisher (çŸ¥ä¹å‘å¸ƒå™¨)
â”œâ”€â”€ CSDNPublisher (CSDNå‘å¸ƒå™¨)
â”œâ”€â”€ JuejinPublisher (æ˜é‡‘å‘å¸ƒå™¨)
â””â”€â”€ ... (å…¶ä»–å¹³å°å‘å¸ƒå™¨)
```

### 2.2 æ ¸å¿ƒç»„ä»¶

#### 2.2.1 BasePlatformPublisher (æŠ½è±¡åŸºç±»)

**èŒè´£**:
- å®šä¹‰ç»Ÿä¸€çš„å‘å¸ƒå™¨æ¥å£
- æä¾›é€šç”¨çš„Cookieç®¡ç†åŠŸèƒ½
- å®ç°é€šç”¨çš„é”™è¯¯å¤„ç†é€»è¾‘
- æä¾›æ—¥å¿—è®°å½•åŠŸèƒ½

**æ ¸å¿ƒæ–¹æ³•**:
```python
class BasePlatformPublisher(ABC):
    @abstractmethod
    def login(self, username, password): pass

    @abstractmethod
    def login_with_qrcode(self): pass

    @abstractmethod
    def publish_article(self, title, content, **kwargs): pass

    @abstractmethod
    def is_logged_in(self): pass

    # é€šç”¨æ–¹æ³•
    def save_cookies(self, cookies, username): pass
    def load_cookies(self, username): pass
    def refresh_cookies(self): pass
```

#### 2.2.2 å…·ä½“å¹³å°å‘å¸ƒå™¨

æ¯ä¸ªå¹³å°éƒ½æœ‰è‡ªå·±çš„å®ç°ç±»,ç»§æ‰¿è‡ª `BasePlatformPublisher`:

**ZhihuPublisher**:
- å®ç°çŸ¥ä¹ç‰¹æœ‰çš„ç™»å½•é€»è¾‘
- å¤„ç†çŸ¥ä¹çš„QRç ç™»å½•
- å®ç°çŸ¥ä¹æ–‡ç« å‘å¸ƒæµç¨‹

**CSDNPublisher**:
- å®ç°CSDNçš„ç™»å½•é€»è¾‘
- å¤„ç†CSDNçš„éªŒè¯ç 
- å®ç°CSDNåšå®¢å‘å¸ƒæµç¨‹

**JuejinPublisher**:
- å®ç°æ˜é‡‘çš„ç™»å½•é€»è¾‘
- å¤„ç†æ˜é‡‘çš„æ–‡ç« ç¼–è¾‘å™¨
- å®ç°æ˜é‡‘æ–‡ç« å‘å¸ƒæµç¨‹

#### 2.2.3 PlatformPublisherFactory (å·¥å‚ç±»)

**èŒè´£**:
- æ ¹æ®å¹³å°åç§°åˆ›å»ºå¯¹åº”çš„å‘å¸ƒå™¨å®ä¾‹
- ç®¡ç†å‘å¸ƒå™¨å®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸ
- æä¾›ç»Ÿä¸€çš„å‘å¸ƒå™¨è·å–æ¥å£

```python
class PlatformPublisherFactory:
    @staticmethod
    def create_publisher(platform_name):
        """åˆ›å»ºå¹³å°å‘å¸ƒå™¨å®ä¾‹"""
        publishers = {
            'zhihu': ZhihuPublisher,
            'csdn': CSDNPublisher,
            'juejin': JuejinPublisher
        }
        return publishers.get(platform_name.lower())()
```

---

## ä¸‰ã€ç›®å½•ç»“æ„

```
backend/
â”œâ”€â”€ publishers/                    # å‘å¸ƒå™¨æ¨¡å—ç›®å½•
â”‚   â”œâ”€â”€ __init__.py               # æ¨¡å—åˆå§‹åŒ–,å¯¼å‡ºå·¥å‚ç±»
â”‚   â”œâ”€â”€ base_publisher.py         # æŠ½è±¡åŸºç±»å®šä¹‰
â”‚   â”œâ”€â”€ zhihu_publisher.py        # çŸ¥ä¹å‘å¸ƒå™¨
â”‚   â”œâ”€â”€ csdn_publisher.py         # CSDNå‘å¸ƒå™¨
â”‚   â”œâ”€â”€ juejin_publisher.py       # æ˜é‡‘å‘å¸ƒå™¨
â”‚   â””â”€â”€ utils/                    # é€šç”¨å·¥å…·
â”‚       â”œâ”€â”€ cookie_manager.py     # Cookieç®¡ç†å·¥å…·
â”‚       â”œâ”€â”€ qrcode_login.py       # QRç ç™»å½•é€šç”¨å·¥å…·
â”‚       â””â”€â”€ logger.py             # æ—¥å¿—å·¥å…·
â”œâ”€â”€ cookies/                      # Cookieå­˜å‚¨ç›®å½•
â”‚   â”œâ”€â”€ zhihu_xxx.json           # çŸ¥ä¹Cookie
â”‚   â”œâ”€â”€ csdn_xxx.json            # CSDN Cookie
â”‚   â””â”€â”€ ...
â””â”€â”€ logs/                        # æ—¥å¿—ç›®å½•
    â”œâ”€â”€ zhihu_publish.log
    â”œâ”€â”€ csdn_publish.log
    â””â”€â”€ ...
```

---

## å››ã€æ¥å£å®šä¹‰

### 4.1 BasePlatformPublisher æŠ½è±¡åŸºç±»

```python
from abc import ABC, abstractmethod
import json
import os
import logging
from typing import Dict, List, Optional, Tuple

class BasePlatformPublisher(ABC):
    """
    å¹³å°å‘å¸ƒå™¨æŠ½è±¡åŸºç±»

    æ‰€æœ‰å¹³å°å‘å¸ƒå™¨å¿…é¡»ç»§æ‰¿æ­¤ç±»å¹¶å®ç°æŠ½è±¡æ–¹æ³•
    """

    def __init__(self, platform_name: str):
        """
        åˆå§‹åŒ–å‘å¸ƒå™¨

        Args:
            platform_name: å¹³å°åç§°(zhihu, csdn, juejinç­‰)
        """
        self.platform_name = platform_name
        self.cookies_dir = os.path.join(os.path.dirname(__file__), '..', 'cookies')
        self.logs_dir = os.path.join(os.path.dirname(__file__), '..', 'logs')
        os.makedirs(self.cookies_dir, exist_ok=True)
        os.makedirs(self.logs_dir, exist_ok=True)

        # é…ç½®æ—¥å¿—
        self.logger = self._setup_logger()

        # æµè§ˆå™¨å®ä¾‹(ç”±å­ç±»åˆå§‹åŒ–)
        self.driver = None

    def _setup_logger(self) -> logging.Logger:
        """é…ç½®æ—¥å¿—è®°å½•å™¨"""
        logger = logging.getLogger(f'{self.platform_name}_publisher')
        logger.setLevel(logging.INFO)

        # æ–‡ä»¶å¤„ç†å™¨
        log_file = os.path.join(self.logs_dir, f'{self.platform_name}_publish.log')
        file_handler = logging.FileHandler(log_file, encoding='utf-8')
        file_handler.setLevel(logging.INFO)

        # æ§åˆ¶å°å¤„ç†å™¨
        console_handler = logging.StreamHandler()
        console_handler.setLevel(logging.INFO)

        # æ ¼å¼åŒ–å™¨
        formatter = logging.Formatter(
            '%(asctime)s - %(name)s - %(levelname)s - %(message)s'
        )
        file_handler.setFormatter(formatter)
        console_handler.setFormatter(formatter)

        logger.addHandler(file_handler)
        logger.addHandler(console_handler)

        return logger

    # ==================== Cookieç®¡ç† ====================

    def save_cookies(self, cookies: List[Dict], username: str) -> str:
        """
        ä¿å­˜Cookieåˆ°æ–‡ä»¶

        Args:
            cookies: Cookieåˆ—è¡¨
            username: ç”¨æˆ·å(ç”¨äºCookieæ–‡ä»¶å‘½å)

        Returns:
            Cookieæ–‡ä»¶è·¯å¾„
        """
        cookie_file = os.path.join(
            self.cookies_dir,
            f'{self.platform_name}_{username}.json'
        )

        with open(cookie_file, 'w', encoding='utf-8') as f:
            json.dump(cookies, f, ensure_ascii=False, indent=2)

        self.logger.info(f'Cookieå·²ä¿å­˜åˆ°: {cookie_file}')
        return cookie_file

    def load_cookies(self, username: str) -> Optional[List[Dict]]:
        """
        ä»æ–‡ä»¶åŠ è½½Cookie

        Args:
            username: ç”¨æˆ·å

        Returns:
            Cookieåˆ—è¡¨,å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨åˆ™è¿”å›None
        """
        cookie_file = os.path.join(
            self.cookies_dir,
            f'{self.platform_name}_{username}.json'
        )

        if not os.path.exists(cookie_file):
            self.logger.warning(f'Cookieæ–‡ä»¶ä¸å­˜åœ¨: {cookie_file}')
            return None

        with open(cookie_file, 'r', encoding='utf-8') as f:
            cookies = json.load(f)

        self.logger.info(f'Cookieå·²åŠ è½½: {cookie_file}')
        return cookies

    def delete_cookies(self, username: str) -> bool:
        """
        åˆ é™¤Cookieæ–‡ä»¶

        Args:
            username: ç”¨æˆ·å

        Returns:
            æ˜¯å¦åˆ é™¤æˆåŠŸ
        """
        cookie_file = os.path.join(
            self.cookies_dir,
            f'{self.platform_name}_{username}.json'
        )

        if os.path.exists(cookie_file):
            os.remove(cookie_file)
            self.logger.info(f'Cookieå·²åˆ é™¤: {cookie_file}')
            return True
        return False

    # ==================== æŠ½è±¡æ–¹æ³•(å­ç±»å¿…é¡»å®ç°) ====================

    @abstractmethod
    def login(self, username: str, password: str) -> Tuple[bool, str]:
        """
        è´¦å·å¯†ç ç™»å½•

        Args:
            username: ç”¨æˆ·å/æ‰‹æœºå·/é‚®ç®±
            password: å¯†ç 

        Returns:
            (æ˜¯å¦æˆåŠŸ, æ¶ˆæ¯)
        """
        pass

    @abstractmethod
    def login_with_qrcode(self) -> Tuple[bool, str, Optional[str]]:
        """
        äºŒç»´ç ç™»å½•

        Returns:
            (æ˜¯å¦æˆåŠŸ, æ¶ˆæ¯, QRç å›¾ç‰‡è·¯å¾„/Base64)
        """
        pass

    @abstractmethod
    def is_logged_in(self) -> bool:
        """
        æ£€æŸ¥æ˜¯å¦å·²ç™»å½•

        Returns:
            æ˜¯å¦å·²ç™»å½•
        """
        pass

    @abstractmethod
    def publish_article(
        self,
        title: str,
        content: str,
        **kwargs
    ) -> Tuple[bool, str, Optional[str]]:
        """
        å‘å¸ƒæ–‡ç« 

        Args:
            title: æ–‡ç« æ ‡é¢˜
            content: æ–‡ç« å†…å®¹
            **kwargs: å¹³å°ç‰¹å®šçš„å…¶ä»–å‚æ•°

        Returns:
            (æ˜¯å¦æˆåŠŸ, æ¶ˆæ¯, æ–‡ç« URL)
        """
        pass

    @abstractmethod
    def get_article_url_after_publish(self) -> Optional[str]:
        """
        è·å–å‘å¸ƒåçš„æ–‡ç« URL

        Returns:
            æ–‡ç« URL,å¦‚æœè·å–å¤±è´¥è¿”å›None
        """
        pass

    # ==================== å¯é€‰æ–¹æ³•(å­ç±»å¯è¦†ç›–) ====================

    def refresh_cookies(self) -> bool:
        """
        åˆ·æ–°Cookie(å­ç±»å¯è¦†ç›–ä»¥å®ç°ç‰¹å®šé€»è¾‘)

        Returns:
            æ˜¯å¦åˆ·æ–°æˆåŠŸ
        """
        self.logger.info('åˆ·æ–°Cookie...')
        return True

    def close(self):
        """
        å…³é—­æµè§ˆå™¨å’Œæ¸…ç†èµ„æº
        """
        if self.driver:
            try:
                self.driver.quit()
                self.logger.info('æµè§ˆå™¨å·²å…³é—­')
            except Exception as e:
                self.logger.error(f'å…³é—­æµè§ˆå™¨å¤±è´¥: {e}')

    def __enter__(self):
        """æ”¯æŒwithè¯­å¥"""
        return self

    def __exit__(self, exc_type, exc_val, exc_tb):
        """é€€å‡ºæ—¶è‡ªåŠ¨æ¸…ç†"""
        self.close()
```

### 4.2 å¹³å°ç‰¹å®šå‚æ•°

ä¸åŒå¹³å°å‘å¸ƒæ–‡ç« æ—¶å¯èƒ½éœ€è¦ä¸åŒçš„å‚æ•°:

**çŸ¥ä¹**:
- `title`: æ ‡é¢˜
- `content`: å†…å®¹(HTMLæˆ–Markdown)
- `column_id`: ä¸“æ ID(å¯é€‰)
- `topic_ids`: è¯é¢˜IDåˆ—è¡¨(å¯é€‰)

**CSDN**:
- `title`: æ ‡é¢˜
- `content`: å†…å®¹(Markdown)
- `tags`: æ ‡ç­¾åˆ—è¡¨
- `category`: åˆ†ç±»
- `type`: æ–‡ç« ç±»å‹(original/reprint/translate)

**æ˜é‡‘**:
- `title`: æ ‡é¢˜
- `content`: å†…å®¹(Markdown)
- `tags`: æ ‡ç­¾åˆ—è¡¨
- `category`: åˆ†ç±»
- `cover_image`: å°é¢å›¾(å¯é€‰)

---

## äº”ã€ä½¿ç”¨ç¤ºä¾‹

### 5.1 åŸºæœ¬ä½¿ç”¨

```python
from publishers import PlatformPublisherFactory

# åˆ›å»ºçŸ¥ä¹å‘å¸ƒå™¨
publisher = PlatformPublisherFactory.create_publisher('zhihu')

# ç™»å½•
success, msg = publisher.login('username', 'password')
if success:
    # å‘å¸ƒæ–‡ç« 
    success, msg, url = publisher.publish_article(
        title='æ–‡ç« æ ‡é¢˜',
        content='æ–‡ç« å†…å®¹...',
        column_id='123456'  # çŸ¥ä¹ç‰¹å®šå‚æ•°
    )

    if success:
        print(f'å‘å¸ƒæˆåŠŸ! URL: {url}')
    else:
        print(f'å‘å¸ƒå¤±è´¥: {msg}')

# å…³é—­
publisher.close()
```

### 5.2 ä½¿ç”¨withè¯­å¥

```python
from publishers import PlatformPublisherFactory

with PlatformPublisherFactory.create_publisher('csdn') as publisher:
    # QRç ç™»å½•
    success, msg, qr_path = publisher.login_with_qrcode()

    if success:
        # å‘å¸ƒæ–‡ç« 
        success, msg, url = publisher.publish_article(
            title='CSDNæ–‡ç« ',
            content='# å†…å®¹...',
            tags=['Python', 'Webå¼€å‘'],  # CSDNç‰¹å®šå‚æ•°
            category='åç«¯',
            type='original'
        )

        print(f'ç»“æœ: {msg}')
```

### 5.3 å¤šå¹³å°åŒæ—¶å‘å¸ƒ

```python
from publishers import PlatformPublisherFactory

platforms = ['zhihu', 'csdn', 'juejin']
article_data = {
    'title': 'é€šç”¨æ ‡é¢˜',
    'content': 'é€šç”¨å†…å®¹...'
}

results = {}

for platform_name in platforms:
    publisher = PlatformPublisherFactory.create_publisher(platform_name)

    try:
        # å‡è®¾å·²ç»ç™»å½•(Cookieå­˜åœ¨)
        if publisher.is_logged_in():
            success, msg, url = publisher.publish_article(**article_data)
            results[platform_name] = {
                'success': success,
                'message': msg,
                'url': url
            }
    finally:
        publisher.close()

print(results)
```

---

## å…­ã€å®ç°ç»†èŠ‚

### 6.1 çŸ¥ä¹å‘å¸ƒå™¨ (ZhihuPublisher)

**ç‰¹ç‚¹**:
- æ”¯æŒQRç ç™»å½•
- Cookieé•¿æœŸæœ‰æ•ˆ
- ä½¿ç”¨DrissionPageè¿›è¡Œè‡ªåŠ¨åŒ–
- æ–‡ç« ç¼–è¾‘å™¨åŸºäºå¯Œæ–‡æœ¬

**å…³é”®å®ç°**:
```python
class ZhihuPublisher(BasePlatformPublisher):
    def __init__(self):
        super().__init__('zhihu')
        # åˆå§‹åŒ–DrissionPage

    def login_with_qrcode(self):
        # 1. è®¿é—®ç™»å½•é¡µ
        # 2. è·å–QRç 
        # 3. ç­‰å¾…æ‰«ç 
        # 4. æ£€æŸ¥ç™»å½•çŠ¶æ€
        # 5. ä¿å­˜Cookie
        pass

    def publish_article(self, title, content, **kwargs):
        # 1. è®¿é—®å†™æ–‡ç« é¡µé¢
        # 2. å¡«å……æ ‡é¢˜
        # 3. å¡«å……å†…å®¹
        # 4. ç‚¹å‡»å‘å¸ƒ
        # 5. è·å–æ–‡ç« URL
        pass
```

### 6.2 CSDNå‘å¸ƒå™¨ (CSDNPublisher)

**ç‰¹ç‚¹**:
- æ”¯æŒè´¦å·å¯†ç ç™»å½•
- éœ€è¦å¤„ç†æ»‘åŠ¨éªŒè¯ç 
- Markdownç¼–è¾‘å™¨
- éœ€è¦é€‰æ‹©åˆ†ç±»å’Œæ ‡ç­¾

**å…³é”®å®ç°**:
```python
class CSDNPublisher(BasePlatformPublisher):
    def __init__(self):
        super().__init__('csdn')

    def login(self, username, password):
        # 1. è®¿é—®ç™»å½•é¡µ
        # 2. è¾“å…¥è´¦å·å¯†ç 
        # 3. å¤„ç†æ»‘åŠ¨éªŒè¯ç 
        # 4. æ£€æŸ¥ç™»å½•çŠ¶æ€
        # 5. ä¿å­˜Cookie
        pass

    def publish_article(self, title, content, **kwargs):
        # 1. è®¿é—®å†™åšå®¢é¡µé¢
        # 2. åˆ‡æ¢åˆ°Markdownç¼–è¾‘å™¨
        # 3. å¡«å……æ ‡é¢˜å’Œå†…å®¹
        # 4. é€‰æ‹©åˆ†ç±»å’Œæ ‡ç­¾
        # 5. ç‚¹å‡»å‘å¸ƒ
        # 6. è·å–æ–‡ç« URL
        pass
```

### 6.3 æ˜é‡‘å‘å¸ƒå™¨ (JuejinPublisher)

**ç‰¹ç‚¹**:
- æ”¯æŒQRç ç™»å½•
- Markdownç¼–è¾‘å™¨
- éœ€è¦é€‰æ‹©åˆ†ç±»å’Œæ ‡ç­¾
- æ”¯æŒå°é¢å›¾

**å…³é”®å®ç°**:
```python
class JuejinPublisher(BasePlatformPublisher):
    def __init__(self):
        super().__init__('juejin')

    def login_with_qrcode(self):
        # ç±»ä¼¼çŸ¥ä¹çš„QRç ç™»å½•
        pass

    def publish_article(self, title, content, **kwargs):
        # 1. è®¿é—®åˆ›ä½œè€…ä¸­å¿ƒ
        # 2. æ–°å»ºæ–‡ç« 
        # 3. å¡«å……å†…å®¹
        # 4. è®¾ç½®åˆ†ç±»ã€æ ‡ç­¾
        # 5. ä¸Šä¼ å°é¢å›¾(å¯é€‰)
        # 6. å‘å¸ƒ
        pass
```

---

## ä¸ƒã€é”™è¯¯å¤„ç†

### 7.1 å¼‚å¸¸ç±»å‹

```python
class PublisherException(Exception):
    """å‘å¸ƒå™¨åŸºç¡€å¼‚å¸¸"""
    pass

class LoginFailedException(PublisherException):
    """ç™»å½•å¤±è´¥å¼‚å¸¸"""
    pass

class PublishFailedException(PublisherException):
    """å‘å¸ƒå¤±è´¥å¼‚å¸¸"""
    pass

class CookieExpiredException(PublisherException):
    """Cookieè¿‡æœŸå¼‚å¸¸"""
    pass

class NetworkException(PublisherException):
    """ç½‘ç»œå¼‚å¸¸"""
    pass
```

### 7.2 é”™è¯¯å¤„ç†æµç¨‹

```python
def publish_article(self, title, content, **kwargs):
    try:
        # å‘å¸ƒé€»è¾‘
        return True, 'å‘å¸ƒæˆåŠŸ', url
    except CookieExpiredException:
        self.logger.error('Cookieå·²è¿‡æœŸ,éœ€è¦é‡æ–°ç™»å½•')
        return False, 'Cookieå·²è¿‡æœŸ,è¯·é‡æ–°ç™»å½•', None
    except NetworkException as e:
        self.logger.error(f'ç½‘ç»œé”™è¯¯: {e}')
        return False, f'ç½‘ç»œé”™è¯¯: {str(e)}', None
    except Exception as e:
        self.logger.error(f'å‘å¸ƒå¤±è´¥: {e}', exc_info=True)
        return False, f'å‘å¸ƒå¤±è´¥: {str(e)}', None
```

---

## å…«ã€æµ‹è¯•ç­–ç•¥

### 8.1 å•å…ƒæµ‹è¯•

æ¯ä¸ªå‘å¸ƒå™¨éƒ½åº”è¯¥æœ‰å¯¹åº”çš„å•å…ƒæµ‹è¯•:

```python
# tests/test_zhihu_publisher.py
import unittest
from publishers import ZhihuPublisher

class TestZhihuPublisher(unittest.TestCase):
    def setUp(self):
        self.publisher = ZhihuPublisher()

    def tearDown(self):
        self.publisher.close()

    def test_login(self):
        success, msg = self.publisher.login('test_user', 'test_pass')
        self.assertTrue(success)

    def test_publish_article(self):
        success, msg, url = self.publisher.publish_article(
            title='æµ‹è¯•æ–‡ç« ',
            content='æµ‹è¯•å†…å®¹'
        )
        self.assertTrue(success)
        self.assertIsNotNone(url)
```

### 8.2 é›†æˆæµ‹è¯•

æµ‹è¯•å¤šå¹³å°åŒæ—¶å‘å¸ƒ:

```python
# tests/test_multi_platform.py
import unittest
from publishers import PlatformPublisherFactory

class TestMultiPlatform(unittest.TestCase):
    def test_all_platforms(self):
        platforms = ['zhihu', 'csdn', 'juejin']

        for platform_name in platforms:
            publisher = PlatformPublisherFactory.create_publisher(platform_name)

            # æµ‹è¯•åˆ›å»ºæˆåŠŸ
            self.assertIsNotNone(publisher)

            # æµ‹è¯•æ¥å£å­˜åœ¨
            self.assertTrue(hasattr(publisher, 'login'))
            self.assertTrue(hasattr(publisher, 'publish_article'))

            publisher.close()
```

---

## ä¹ã€éƒ¨ç½²å’Œé…ç½®

### 9.1 ç¯å¢ƒå˜é‡

```bash
# .env
# å¹³å°è´¦å·é…ç½®(ç”¨äºæµ‹è¯•)
ZHIHU_TEST_USER=your_username
ZHIHU_TEST_PASSWORD=your_password

CSDN_TEST_USER=your_username
CSDN_TEST_PASSWORD=your_password

# DrissionPageé…ç½®
CHROME_DRIVER_PATH=/path/to/chromedriver
CHROME_HEADLESS=true  # æ— å¤´æ¨¡å¼
```

### 9.2 é…ç½®æ–‡ä»¶

```python
# publishers/config.py

PLATFORM_CONFIG = {
    'zhihu': {
        'base_url': 'https://www.zhihu.com',
        'login_url': 'https://www.zhihu.com/signin',
        'write_url': 'https://zhuanlan.zhihu.com/write',
        'timeout': 30
    },
    'csdn': {
        'base_url': 'https://www.csdn.net',
        'login_url': 'https://passport.csdn.net/login',
        'write_url': 'https://mp.csdn.net/mp_blog/creation/editor',
        'timeout': 30
    },
    'juejin': {
        'base_url': 'https://juejin.cn',
        'login_url': 'https://juejin.cn/login',
        'write_url': 'https://juejin.cn/editor/drafts/new',
        'timeout': 30
    }
}
```

---

## åã€æœªæ¥æ‰©å±•

### 10.1 è®¡åˆ’åŠŸèƒ½

- [ ] æ–‡ç« è‰ç¨¿ç®¡ç†
- [ ] å®šæ—¶å‘å¸ƒåŠŸèƒ½
- [ ] æ–‡ç« æ›´æ–°åŠŸèƒ½
- [ ] æ‰¹é‡å‘å¸ƒåŠŸèƒ½
- [ ] å‘å¸ƒå†å²æŸ¥è¯¢
- [ ] æ–‡ç« æ•°æ®ç»Ÿè®¡

### 10.2 æ–°å¹³å°æ”¯æŒ

æ·»åŠ æ–°å¹³å°åªéœ€3æ­¥:

1. åˆ›å»ºæ–°çš„å‘å¸ƒå™¨ç±»ç»§æ‰¿ `BasePlatformPublisher`
2. å®ç°æ‰€æœ‰æŠ½è±¡æ–¹æ³•
3. åœ¨å·¥å‚ç±»ä¸­æ³¨å†Œæ–°å¹³å°

```python
# publishers/new_platform_publisher.py
class NewPlatformPublisher(BasePlatformPublisher):
    def __init__(self):
        super().__init__('new_platform')

    # å®ç°æ‰€æœ‰æŠ½è±¡æ–¹æ³•...

# publishers/__init__.py
from .new_platform_publisher import NewPlatformPublisher

class PlatformPublisherFactory:
    @staticmethod
    def create_publisher(platform_name):
        publishers = {
            'zhihu': ZhihuPublisher,
            'csdn': CSDNPublisher,
            'juejin': JuejinPublisher,
            'new_platform': NewPlatformPublisher  # æ–°å¢
        }
        return publishers.get(platform_name.lower())()
```

---

## åä¸€ã€å‚è€ƒèµ„æ–™

- DrissionPageæ–‡æ¡£: https://drissionpage.cn
- Seleniumæ–‡æ¡£: https://www.selenium.dev/documentation/
- å„å¹³å°APIæ–‡æ¡£(å¦‚æœæœ‰)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2024-12
**ç»´æŠ¤è€…**: TOP_N Development Team
