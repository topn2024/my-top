<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éªŒè¯æ¸…ç†æŒ‰é’® - TOP_N</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 { color: #333; }
        h2 {
            color: #666;
            margin-top: 30px;
            padding-bottom: 10px;
            border-bottom: 2px solid #4CAF50;
        }
        .button-group {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        button {
            padding: 10px 20px;
            font-size: 14px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            color: white;
            transition: all 0.3s;
        }
        button:hover {
            opacity: 0.8;
            transform: translateY(-2px);
        }
        .btn-success { background-color: #10b981; }
        .btn-danger { background-color: #ef4444; }
        .btn-warning { background-color: #f59e0b; }
        .btn-secondary { background-color: #6b7280; }
        .btn-primary { background-color: #3b82f6; }

        .status {
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
            border-left: 4px solid;
        }
        .status.success {
            background: #d1fae5;
            border-color: #10b981;
            color: #065f46;
        }
        .status.error {
            background: #fee2e2;
            border-color: #ef4444;
            color: #991b1b;
        }
        .status.info {
            background: #dbeafe;
            border-color: #3b82f6;
            color: #1e40af;
        }

        .checklist {
            list-style: none;
            padding: 0;
        }
        .checklist li {
            padding: 10px;
            margin: 5px 0;
            background: #f9fafb;
            border-left: 3px solid #3b82f6;
        }
        .checklist li.done {
            background: #d1fae5;
            border-left-color: #10b981;
        }
        .checklist li.done::before {
            content: "âœ“ ";
            color: #10b981;
            font-weight: bold;
        }

        code {
            background: #f3f4f6;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
            color: #dc2626;
        }

        pre {
            background: #1f2937;
            color: #f3f4f6;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” æ¸…ç†æŒ‰é’®éªŒè¯é¡µé¢</h1>

        <div class="status info">
            <strong>è¯´æ˜ï¼š</strong>è¿™ä¸ªé¡µé¢ç”¨äºéªŒè¯æ¸…ç†ä»»åŠ¡æŒ‰é’®çš„åŠŸèƒ½æ˜¯å¦æ­£å¸¸ã€‚
        </div>

        <h2>1. æµ‹è¯•æŒ‰é’®æ˜¾ç¤º</h2>
        <p>ä»¥ä¸‹æ˜¯æ¸…ç†ä»»åŠ¡çš„æŒ‰é’®ï¼ˆåº”è¯¥å’Œå‘å¸ƒé¡µé¢ä¸€æ ·ï¼‰ï¼š</p>
        <div class="button-group">
            <button class="btn-success">ğŸ—‘ï¸ æ¸…ç†æˆåŠŸä»»åŠ¡</button>
            <button class="btn-danger">ğŸ—‘ï¸ æ¸…ç†å¤±è´¥ä»»åŠ¡</button>
            <button class="btn-warning">ğŸ—‘ï¸ æ¸…ç†å…¨éƒ¨å·²å®Œæˆ</button>
            <button class="btn-secondary">ğŸ”„ åˆ·æ–°ä¸´æ—¶æ–‡ç« æ ‡é¢˜</button>
        </div>

        <h2>2. æ’æŸ¥æ¸…å•</h2>
        <ul class="checklist">
            <li id="check-html">æ£€æŸ¥ publish.html æ–‡ä»¶ä¸­æ˜¯å¦åŒ…å«æ¸…ç†æŒ‰é’®ä»£ç </li>
            <li id="check-js">æ£€æŸ¥ publish_history.js æ–‡ä»¶ä¸­æ˜¯å¦åŒ…å«æ¸…ç†å‡½æ•°</li>
            <li id="check-api">æ£€æŸ¥åç«¯ /task/clear API æ˜¯å¦å­˜åœ¨</li>
            <li id="check-blueprint">æ£€æŸ¥ task_api è“å›¾æ˜¯å¦å·²æ³¨å†Œ</li>
        </ul>

        <h2>3. å¯èƒ½çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ</h2>

        <h3>é—®é¢˜1: æµè§ˆå™¨ç¼“å­˜</h3>
        <div class="status info">
            <strong>è§£å†³æ–¹æ³•ï¼š</strong>
            <ul>
                <li>æŒ‰ <code>Ctrl + Shift + R</code> (Windows/Linux) æˆ– <code>Cmd + Shift + R</code> (Mac) å¼ºåˆ¶åˆ·æ–°</li>
                <li>æˆ–è€…æ¸…ç©ºæµè§ˆå™¨ç¼“å­˜åé‡æ–°è®¿é—®</li>
            </ul>
        </div>

        <h3>é—®é¢˜2: CSSæ ·å¼å†²çª</h3>
        <div class="status info">
            <strong>æ£€æŸ¥æ–¹æ³•ï¼š</strong>
            <ol>
                <li>æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·</li>
                <li>åˆ‡æ¢åˆ° Elements æ ‡ç­¾</li>
                <li>æœç´¢ "æ¸…ç†æˆåŠŸä»»åŠ¡"</li>
                <li>æ£€æŸ¥å…ƒç´ æ˜¯å¦å­˜åœ¨ï¼Œä»¥åŠæ˜¯å¦æœ‰ <code>display: none</code> ç­‰éšè—æ ·å¼</li>
            </ol>
        </div>

        <h3>é—®é¢˜3: JavaScriptåŠ è½½å¤±è´¥</h3>
        <div class="status info">
            <strong>æ£€æŸ¥æ–¹æ³•ï¼š</strong>
            <ol>
                <li>æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·</li>
                <li>åˆ‡æ¢åˆ° Console æ ‡ç­¾</li>
                <li>æŸ¥çœ‹æ˜¯å¦æœ‰JavaScripté”™è¯¯ï¼ˆçº¢è‰²æ–‡å­—ï¼‰</li>
                <li>åœ¨Consoleä¸­è¾“å…¥: <code>publishHistoryManager</code>ï¼ŒæŒ‰å›è½¦</li>
                <li>å¦‚æœæ˜¾ç¤ºå¯¹è±¡ä¿¡æ¯åˆ™æ­£å¸¸ï¼Œå¦‚æœæ˜¾ç¤º undefined åˆ™è¯´æ˜JSæœªåŠ è½½</li>
            </ol>
        </div>

        <h3>é—®é¢˜4: æœåŠ¡å™¨ä»£ç æœªæ›´æ–°</h3>
        <div class="status info">
            <strong>è§£å†³æ–¹æ³•ï¼š</strong>
            <ol>
                <li>ç¡®è®¤æ–‡ä»¶å·²ä¿å­˜</li>
                <li>é‡å¯FlaskæœåŠ¡å™¨</li>
                <li>é‡æ–°è®¿é—®é¡µé¢</li>
            </ol>
        </div>

        <h2>4. æ‰‹åŠ¨éªŒè¯æ­¥éª¤</h2>

        <h3>æ­¥éª¤1: æ£€æŸ¥HTMLæºä»£ç </h3>
        <p>åœ¨å‘å¸ƒé¡µé¢æŒ‰ <code>Ctrl + U</code> æŸ¥çœ‹æºä»£ç ï¼Œæœç´¢ "æ¸…ç†æˆåŠŸä»»åŠ¡"ï¼Œåº”è¯¥èƒ½æ‰¾åˆ°æŒ‰é’®ä»£ç ã€‚</p>

        <h3>æ­¥éª¤2: æ£€æŸ¥å¼€å‘è€…å·¥å…·</h3>
        <pre>
// åœ¨æµè§ˆå™¨Consoleä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

// 1. æ£€æŸ¥ publishHistoryManager å¯¹è±¡æ˜¯å¦å­˜åœ¨
console.log(publishHistoryManager);

// 2. æµ‹è¯•æ¸…ç†å‡½æ•°æ˜¯å¦å­˜åœ¨
console.log(typeof publishHistoryManager.clearSuccessTasks);
console.log(typeof publishHistoryManager.clearFailedTasks);
console.log(typeof publishHistoryManager.clearCompletedTasks);

// 3. æŸ¥æ‰¾æ¸…ç†æŒ‰é’®
document.querySelectorAll('button').forEach(btn => {
    if (btn.textContent.includes('æ¸…ç†')) {
        console.log('æ‰¾åˆ°æ¸…ç†æŒ‰é’®:', btn.textContent);
    }
});
        </pre>

        <h3>æ­¥éª¤3: æµ‹è¯•APIæ¥å£</h3>
        <p>åœ¨æµè§ˆå™¨Consoleä¸­è¿è¡Œï¼š</p>
        <pre>
// æµ‹è¯•æ¸…ç†APIæ˜¯å¦å¯ç”¨
fetch('/task/clear', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({status_filter: ['test']})
})
.then(r => r.json())
.then(data => console.log('APIå“åº”:', data))
.catch(e => console.error('APIé”™è¯¯:', e));
        </pre>

        <h2>5. å¿«é€Ÿä¿®å¤å‘½ä»¤</h2>
        <p>å¦‚æœä»¥ä¸Šéƒ½ä¸è¡Œï¼Œåœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œï¼š</p>
        <pre>
# 1. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la D:/work/code/TOP_N/templates/publish.html
ls -la D:/work/code/TOP_N/static/publish_history.js

# 2. é‡å¯FlaskæœåŠ¡
# æ‰¾åˆ°è¿›ç¨‹
ps aux | grep "app_factory\|app_with_upload"

# æ€æ­»è¿›ç¨‹
kill -9 [è¿›ç¨‹ID]

# é‡æ–°å¯åŠ¨
cd D:/work/code/TOP_N
python backend/app_factory.py
        </pre>

        <h2>6. ä¸´æ—¶æµ‹è¯•</h2>
        <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æµ‹è¯•æ¸…ç†åŠŸèƒ½ï¼ˆéœ€è¦å…ˆç™»å½•ï¼‰ï¼š</p>
        <div class="button-group">
            <button class="btn-primary" onclick="testClearAPI()">æµ‹è¯•æ¸…ç†API</button>
            <button class="btn-secondary" onclick="openPublishPage()">æ‰“å¼€å‘å¸ƒé¡µé¢</button>
        </div>

        <div id="test-result"></div>
    </div>

    <script>
        // æµ‹è¯•æ¸…ç†API
        async function testClearAPI() {
            const resultDiv = document.getElementById('test-result');
            resultDiv.innerHTML = '<div class="status info">æ­£åœ¨æµ‹è¯•API...</div>';

            try {
                const response = await fetch('/task/clear', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        status_filter: ['success']  // æµ‹è¯•æ¸…ç†æˆåŠŸçš„ä»»åŠ¡
                    })
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    resultDiv.innerHTML = `
                        <div class="status success">
                            <strong>âœ“ APIæµ‹è¯•æˆåŠŸï¼</strong><br>
                            åˆ é™¤äº† ${data.deleted_count} ä¸ªä»»åŠ¡<br>
                            æ¶ˆæ¯: ${data.message}
                        </div>
                    `;
                    markCheckDone('check-api');
                } else {
                    resultDiv.innerHTML = `
                        <div class="status error">
                            <strong>âœ— APIè¿”å›é”™è¯¯</strong><br>
                            ${data.error || data.message || 'æœªçŸ¥é”™è¯¯'}
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="status error">
                        <strong>âœ— APIè¯·æ±‚å¤±è´¥</strong><br>
                        ${error.message}<br>
                        <small>å¯èƒ½æ˜¯æœªç™»å½•æˆ–åç«¯APIæœªå¯åŠ¨</small>
                    </div>
                `;
            }
        }

        // æ‰“å¼€å‘å¸ƒé¡µé¢
        function openPublishPage() {
            window.open('/publish', '_blank');
        }

        // æ ‡è®°æ£€æŸ¥é¡¹å®Œæˆ
        function markCheckDone(id) {
            const item = document.getElementById(id);
            if (item) {
                item.classList.add('done');
            }
        }

        // é¡µé¢åŠ è½½æ—¶çš„è‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('load', () => {
            // æ£€æŸ¥publish_history.jsæ˜¯å¦åŠ è½½
            if (typeof publishHistoryManager !== 'undefined') {
                markCheckDone('check-js');
            }
        });
    </script>
</body>
</html>
